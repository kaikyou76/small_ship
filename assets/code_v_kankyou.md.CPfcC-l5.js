import{_ as a,c as i,o as n,ae as t}from"./chunks/framework.4ukD4ZLJ.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"code/v_kankyou.md","filePath":"code/v_kankyou.md"}'),e={name:"code/v_kankyou.md"};function p(l,s,h,k,r,d){return n(),i("div",null,s[0]||(s[0]=[t(`<p>✅ Vercel への環境変数設定 現在の設定と必要な認証設定について説明します。問題の原因として、NextAuth.js（認証ライブラリ）の本番環境設定が不足している可能性が高いです。</p><h3 id="現在の設定状況" tabindex="-1">現在の設定状況 <a class="header-anchor" href="#現在の設定状況" aria-label="Permalink to &quot;現在の設定状況&quot;">​</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light material-theme-darker vp-code" tabindex="0"><code><span class="line"><span># .env.production</span></span>
<span class="line"><span>NEXT_PUBLIC_API_BASE_URL=https://backend-production.kai-kyou.workers.dev</span></span></code></pre></div><h3 id="不足している認証関連の設定" tabindex="-1">不足している認証関連の設定 <a class="header-anchor" href="#不足している認証関連の設定" aria-label="Permalink to &quot;不足している認証関連の設定&quot;">​</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light material-theme-darker vp-code" tabindex="0"><code><span class="line"><span># 必須設定（NextAuth.js用）</span></span>
<span class="line"><span>NEXTAUTH_URL=https://kaikyou-online-shop.vercel.app</span></span>
<span class="line"><span>NEXTAUTH_SECRET=your-strong-secret-key-here</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 推奨追加設定</span></span>
<span class="line"><span>NEXT_PUBLIC_NEXTAUTH_URL=https://kaikyou-online-shop.vercel.app</span></span>
<span class="line"><span>NEXTAUTH_URL_INTERNAL=http://localhost:3000  # 開発用</span></span></code></pre></div><h3 id="各設定値の詳細説明" tabindex="-1">各設定値の詳細説明 <a class="header-anchor" href="#各設定値の詳細説明" aria-label="Permalink to &quot;各設定値の詳細説明&quot;">​</a></h3><table tabindex="0"><thead><tr><th>設定キー</th><th>値の例</th><th>説明</th></tr></thead><tbody><tr><td><code>NEXTAUTH_URL</code></td><td><code>https://kaikyou-online-shop.vercel.app</code></td><td>本番環境のベース URL（必須）</td></tr><tr><td><code>NEXTAUTH_SECRET</code></td><td>ランダムな文字列</td><td>セッションの暗号化用（32 文字以上推奨）</td></tr><tr><td><code>NEXT_PUBLIC_NEXTAUTH_URL</code></td><td>同上</td><td>クライアントサイドで参照する URL</td></tr><tr><td><code>NEXT_PUBLIC_API_BASE_URL</code></td><td>既にある設定</td><td>API エンドポイント</td></tr></tbody></table><h3 id="正しい-env-productionの完成例" tabindex="-1">正しい<code>.env.production</code>の完成例 <a class="header-anchor" href="#正しい-env-productionの完成例" aria-label="Permalink to &quot;正しい\`.env.production\`の完成例&quot;">​</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light material-theme-darker vp-code" tabindex="0"><code><span class="line"><span># API設定</span></span>
<span class="line"><span>NEXT_PUBLIC_API_BASE_URL=https://backend-production.kai-kyou.workers.dev</span></span>
<span class="line"><span></span></span>
<span class="line"><span># NextAuth設定</span></span>
<span class="line"><span>NEXTAUTH_URL=https://kaikyou-online-shop.vercel.app</span></span>
<span class="line"><span>NEXTAUTH_SECRET=your-very-strong-secret-key-32-chars-minimum</span></span>
<span class="line"><span>NEXT_PUBLIC_NEXTAUTH_URL=https://kaikyou-online-shop.vercel.app</span></span>
<span class="line"><span></span></span>
<span class="line"><span># オプション（開発用）</span></span>
<span class="line"><span>NEXTAUTH_URL_INTERNAL=http://localhost:3000</span></span></code></pre></div><h3 id="設定時の注意点" tabindex="-1">設定時の注意点 <a class="header-anchor" href="#設定時の注意点" aria-label="Permalink to &quot;設定時の注意点&quot;">​</a></h3><ol><li><p><strong><code>NEXTAUTH_SECRET</code>の生成方法</strong>（必須）:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light material-theme-darker vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#F78C6C;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># または</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;">console.log(require(&#39;crypto&#39;).randomBytes(32).toString(&#39;base64&#39;))</span><span style="--shiki-light:#032F62;--shiki-dark:#89DDFF;">&quot;</span></span></code></pre></div></li><li><p><strong>Vercel への環境変数設定</strong>:</p><ul><li>Vercel ダッシュボード → プロジェクト → Settings → Environment Variables</li><li>すべての変数を追加（本番環境用）</li></ul></li><li><p><strong>NextAuth 設定ファイルの確認</strong>:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light material-theme-darker vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;">// auth.ts または [...nextauth].ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-light-font-style:inherit;--shiki-dark:#89DDFF;--shiki-dark-font-style:italic;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C792EA;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#EEFFFF;"> authOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#89DDFF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;"> NextAuthOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#89DDFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F07178;">  providers</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;"> [</span><span style="--shiki-light:#D73A49;--shiki-dark:#89DDFF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F07178;">  secret</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#EEFFFF;">NEXTAUTH_SECRET</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F07178;">  basePath</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#EEFFFF;">NEXTAUTH_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">}</span></span></code></pre></div></li><li><p><strong>本番環境での動作確認手順</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light material-theme-darker vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># 1. ビルド</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># 2. 本番モードで起動</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> start</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># 3. ブラウザで確認</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">open</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> http://localhost:3000/register</span></span></code></pre></div></li></ol><p>この設定後、Vercel で再デプロイを実行すれば、<code>/register</code>ページが正しく動作するはずです。特に<code>NEXTAUTH_SECRET</code>はセキュリティ上非常に重要なので、必ず強力なキーを設定してください。</p>`,12)]))}const g=a(e,[["render",p]]);export{c as __pageData,g as default};
